<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UNRAVEL SERVER ‚Äì Access Registration</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Courier+New:wght@400;700&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
/* ================= RESET ================= */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

/* ================= BODY ================= */
body {
  font-family: 'Rajdhani', sans-serif;
  background: linear-gradient(135deg, #2d130b, #560a1b);
  background-size: 300% 300%;
  animation: gradientShift 10s ease infinite;
  color: #eaeaea;
  min-height: 90vh;
  overflow-x: hidden;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ================= BACKGROUND OVERLAYS ================= */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 20% 30%, rgba(255, 87, 34, 0.15), transparent 45%),
    radial-gradient(circle at 80% 70%, rgba(156, 39, 176, 0.15), transparent 45%);
  z-index: -2;
}

body::after {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    to bottom,
    rgba(255,255,255,0.04),
    rgba(255,255,255,0.04) 1px,
    transparent 1px,
    transparent 4px
  );
  z-index: -1;
  pointer-events: none;
}

/* ================= CONTAINER ================= */
.container {
  max-width: 700px;
  margin: 60px auto;
  padding: 40px;
  background: rgba(0, 0, 0, 0.6);
  border-radius: 12px;
  backdrop-filter: blur(18px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow:
    0 0 30px rgba(255, 87, 34, 0.35),
    0 0 60px rgba(156, 39, 176, 0.25);
  transition: transform 0.6s ease, box-shadow 0.6s ease;
}

.container:hover {
  transform: translateY(-4px);
  box-shadow:
    0 0 45px rgba(255, 87, 34, 0.6),
    0 0 90px rgba(156, 39, 176, 0.45);
}

/* ================= HEADER ================= */
h1 {
  text-align: center;
  font-size: 2.8rem;
  letter-spacing: 3px;
  text-transform: uppercase;

  background: linear-gradient(135deg, #ff5722, #9c27b0);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  text-shadow:
    0 0 15px rgba(255, 86, 34, 0.94),
    0 0 35px rgba(143, 39, 161, 0.911);

  animation: subtleGlitch 3s infinite;
  margin-bottom: 35px;
}

@keyframes subtleGlitch {
  0%, 92%, 100% { transform: translate(0); }
  94% { transform: translateX(1px); }
  96% { transform: translateX(-1px); }
}

/* ================= FORM ================= */
.input-group {
  margin-bottom: 25px;
}

.server-label {
  display: block;
  margin-bottom: 8px;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: #ff9a76;
}

input {
  width: 100%;
  padding: 15px;
  background: rgba(0, 0, 0, 0.65);
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-radius: 8px;
  color: #fff;
  font-size: 1.1rem;
  transition: all 0.3s ease;
}

input::placeholder {
  color: #a9a8a863;
}

input:focus {
  outline: none;
  border-color: #ff5722;
  background: rgba(0, 0, 0, 0.8);
  box-shadow:
    0 0 12px rgba(255, 87, 34, 0.45),
    0 0 22px rgba(156, 39, 176, 0.35);
}

/* ================= BUTTON ================= */
button {
  width: 100%;
  padding: 18px;
  margin-top: 30px;

  background: linear-gradient(135deg, #ff5722, #9c27b0);
  border: none;
  border-radius: 10px;

  color: #fff;
  font-size: 1.3rem;
  letter-spacing: 3px;
  text-transform: uppercase;

  cursor: pointer;
  transition: all 0.35s ease;

  box-shadow:
    0 0 15px rgba(255, 87, 34, 0.6),
    0 0 30px rgba(156, 39, 176, 0.5);
}

button:hover {
  transform: translateY(-3px);
  box-shadow:
    0 0 25px rgba(255, 87, 34, 0.8),
    0 0 55px rgba(156, 39, 176, 0.7);
}

button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

/* ================= FOOTER ================= */
.server-footer {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.15);
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  color: #aaa;
}

#access-timer {
  color: #ff5722;
  font-weight: bold;
}

/* ================= TIMER ================= */
.access-timer {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.75);
  border-radius: 10px;
  padding: 15px;
  display: flex;
  align-items: center;
  gap: 12px;

  border: 1px solid rgba(255, 255, 255, 0.15);
  box-shadow:
    0 0 15px rgba(255, 87, 34, 0.4),
    0 0 30px rgba(156, 39, 176, 0.35);
}

.timer-icon {
  font-size: 1.8rem;
  color: #780d57;
}

#timer-display {
  font-size: 1.5rem;
  font-weight: bold;
  color: #af3a8a;
}

/* ================= WARNING ================= */
.warning-pulse {
  animation: warningPulse 1s infinite;
}

@keyframes warningPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
  .container {
    margin: 20px;
    padding: 25px;
  }

  h1 {
    font-size: 2rem;
  }
}
</style>
</head>
<body>
  <!-- Block back button -->
  <script src="js/config.js"></script>
  <script>
    history.pushState(null, "", location.href);
    window.onpopstate = function () {
      history.pushState(null, "", location.href);
    };

    // Check if already registered
     if (localStorage.getItem("unravel_registered")) {
  window.location.href = "start.html";
}
    console.log("üöÄ SERVER REGISTRATION INTERFACE LOADED");
  </script>

  <!-- Server Scan Effect -->
  
  <!-- Binary Floating Background -->
  <div class="binary-float"></div>
  
  <!-- Server Status LED -->
  <div class="server-status"></div>

  <!-- Main Container -->
  <div class="container flicker">
    <h1>REGISTER</h1>
    
    

    <form id="server-registration-form" onsubmit="registerUser(event)">
      <div class="input-group">
        <label for="name" class="server-label">Name</label>
        <input id="name" placeholder="Enter full name" required>
      </div>

      <div class="input-group">
        <label for="email" class="server-label">Email ID</label>
        <input id="email" type="email" placeholder="user@domain.com" required>
      </div>

      <div class="input-group">
        <label for="phone" class="server-label">Phone number</label>
        <input id="phone" placeholder="1234567890" required>
      </div>

      <button type="submit" id="register-btn">
        Register
      </button>
    </form>

    
  </div>

  <!-- Access Timer Display -->
  <div class="access-timer">
    <div class="timer-icon"><i class="fas fa-clock"></i></div>
    <div class="timer-text">
      <div>SESSION TIMER</div>
      <div id="timer-display">05:00</div>
    </div>
  </div>

  <script>
    // Registration function
    function registerUser(e) {
  e.preventDefault();

  const user = {
    name: document.getElementById("name").value.trim(),
    email: document.getElementById("email").value.trim(),
    phone: document.getElementById("phone").value.trim(),

    phase1Denied: 0,
    phase2Denied: 0,
    phase1Completed: false,
    phase2Completed: false,
    phase1Disqualified: false,
    phase2Disqualified: false,
    phase1Score: 0,
    phase2Score: 0,
    timeBonus: 0,
    totalScore: 0
  };

  // Send to backend
  sendRegistrationToBackend(user).then(() => {
    localStorage.setItem("unravel_user", user.name);
    localStorage.setItem("unravel_user_data", JSON.stringify(user));
    localStorage.setItem("unravel_registered", "true");

    console.log("‚úÖ USER REGISTERED:", user);

    window.location.href = "start.html";
  }).catch(err => {
    console.error("‚ùå REGISTRATION FAILED:", err);
    showServerError("Registration failed. Please try again.");
  });
}

async function sendRegistrationToBackend(user) {
  const payload = {
    user: user,
    timestamp: Date.now()
  };
  
  try {
    // Detect backend URL dynamically
    const backendURL = `${window.API_BASE}/register`;
    
    console.log('üì§ SENDING TO BACKEND:', backendURL);
    console.log('üì¶ PAYLOAD:', payload);
    
    const response = await fetch(backendURL, {
      method: 'POST',
      headers: { 
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload),
      mode: 'cors'
    });
    
    const responseData = await response.json();
    console.log('üì• BACKEND RESPONSE:', responseData);
    
    if (response.ok && responseData.success) {
      console.log('‚úÖ REGISTRATION SYNCED WITH BACKEND');
      // Store userId
      user.id = responseData.userId;
      localStorage.setItem("unravel_user_id", responseData.userId);
      // Store sync timestamp
      localStorage.setItem("last_backend_sync", Date.now());
    } else {
      throw new Error(responseData.message || 'Backend error');
    }
  } catch (err) {
    console.error('‚ùå BACKEND SYNC FAILED:', err);
    // Don't fail registration if backend is down
    localStorage.setItem("backend_sync_failed", Date.now());
    throw err;
    
  }
}

    
    // Initialize timer
    document.addEventListener('DOMContentLoaded', function() {
      let timeLeft = 300; // 5 minutes in seconds
      const timerDisplay = document.getElementById('timer-display');
const accessTimer = document.querySelector('.access-timer');
      
      function updateTimer() {
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          timerDisplay.textContent = 'EXPIRED';
          document.querySelector('.access-timer').style.color = '#ff4d4d';
          document.querySelector('.access-timer').classList.add('warning-pulse');
          
          // Show expired message
          const container = document.querySelector('.container');
          const expiredMsg = document.createElement('div');
          expiredMsg.innerHTML = '<div style="text-align:center; margin-top:20px; padding:15px; background:rgba(100,0,0,0.3); border:1px solid #c00;"><i class="fas fa-exclamation-triangle"></i> ACCESS WINDOW EXPIRED. PLEASE REFRESH.</div>';
          container.appendChild(expiredMsg);
          
          return;
        }
        
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        const timeString = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        
        timerDisplay.textContent = timeString;
        
        if (timeLeft <= 60) { // Last minute warning
          document.querySelector('.access-timer').classList.add('warning-pulse');
        }
        
        timeLeft--;
      }
      
      const timerInterval = setInterval(updateTimer, 1000);
      updateTimer(); // Initial call
      
      // Add input focus effects
      document.querySelectorAll('input').forEach(input => {
        input.addEventListener('focus', function() {
          this.parentElement.classList.add('focused');
        });
        
        input.addEventListener('blur', function() {
          this.parentElement.classList.remove('focused');
        });
        
        // Real-time validation
        input.addEventListener('input', function() {
          const group = this.parentElement;
          if (this.value.trim()) {
            group.classList.add('has-value');
          } else {
            group.classList.remove('has-value');
          }
        });
      });
      
      // Add subtle flicker to container
      const container = document.querySelector('.container');
      setInterval(() => {
        if (Math.random() > 0.7) {
          container.style.boxShadow = '0 0 40px rgba(200, 0, 0, 0.5)';
          setTimeout(() => {
            container.style.boxShadow = '0 0 30px rgba(120, 0, 0, 0.3)';
          }, 100);
        }
      }, 3000);
      
      // Show server status in console
      console.log('üñ•Ô∏è Server Registration Terminal Ready');
      console.log('üîß System Check: All modules functional');
      console.log('üì° Backend Connection: ' + (navigator.onLine ? 'Online' : 'Offline'));
    });
  </script>
</body>
</html>